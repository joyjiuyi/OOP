# CCF 中国软件大会-云际计算技术论坛——笔记+感受

## 										乔怡 2019K8009970012

### （一）笔记

在参与了云际计算技术论坛后，我感触颇深，受益匪浅。大会邀请了在云际计算领域的8位大家来分别就他们研究的领域进行分享和讲解，下面是我在参会过程中整理下来的笔记：<br/><br/>

#### 一、腾讯云TencentOS“如意”:大规模容器集群混部助力云际计算

##### 1、云际计算和业务混部

**在云际计算的场景中通过业务混部提升资源的使用率**：

在**传统的云部署场景**中，不同的公司或部门有自己独立的云，各个云之间是独立的，负载会不均衡，云之间的使用率也是各不相同的。如果资源使用率比较低，就会带来比较大的成本压力。

在云际计算的背景下就可以通过**业务混部**来提升资源利用率从而降低成本压力。要打破不同云之间的云间壁垒，将业务分为在线业务和离线业务，并将在线业务和离线业务统筹部署到云平台上面。

**混部**即是通过容器隔离，在不影响在线业务服务指令的前提下，尽可能的提升服务器资源使用率。<br/>

##### 2、混部产品“如意”及其主要功能

**第一代混部**：集群层面的混部（粗粒度、存在资源闲置碎片、延迟高、资源无法充分利用）

**第二代混部**：将上层的K8S和底层的运行架构相结合。

**传统的CPU QoS**：基于社区shares+period/quota方案（在线抢占离线不及时、毛刺增加、失败率升高）

**如意的CPU QoS**：（1）绝对抢占（对在线业务干扰小、低开销、资源利用率高、简化调度策略）

​								（2）离线负载均衡

​								（3）超线程隔离

​								（4）离线压制水位线

**传统的QoS**：

​	网络QoS：DSCP（受限于网络环境、适用于发方向，收方向需要配置对端、配置繁琐）

​	网络QoS：TC（性能损耗、适用于发方向、配置繁琐）

**如意QoS**：网络带宽隔离、网络带宽优先级抢占、最低保障和端口白名单、网络整机限速；<br/>

##### 3、“如意“的价值和收益

如意助力节能减排<br/><br/>



#### 二、云网融合 云际畅联——天翼云

##### 1、分布式云 打造企业上云新范式

本地节点 客户节点 边缘节点 业务现场

##### 2、云网融合 高速泛在 千城万池

##### 3、自研攻关 云网操作系统

从服务器操作系统到超大规模资源池云操作系统，从独立的云、网到云网操作系统统一调度

##### 4、多云管理 平台互通 优势显著

##### 5、同心同行 共建开放生态<br/><br/>



#### 三、Karmada架构与实现

##### 1、Karmada背景及简介

多云、多集群已经成为常态;

**云原生多云集群的典型阶段**：一群孤岛——威尼斯水城——大航海时代

**云原生的多云仍然充满挑战**：集群繁多、业务分散、集群的边界限制、厂商绑定

**Karmada**：开源的云原生多云容器编排平台，使用Karmada构建无限可扩展的容器资源池，让开发者像使用K8S集群一样使用多云;

##### 2、Karmada架构与理念

**Karmada架构**：

​	提供一个Karmada API-server，两个控制器，实现多集群,有两个模式;

**Karmada核心理念**：

​	（1）无需修改即可创建多集群应用

​	（2）可重用的应用多集群调度策略

​	（3）通用类型，驱动内部流程

​	（4）跨集群可重用的差异化配置策略

​	（5）子集群最终资源在联邦层的映射

**Karmada策略：**

​	（1）零改造——使用K8S原生API部署一个多集群应用

​	（2）Propagation Policy：可重用的应用多集群调度策略

​	（3）Override Policy：跨集群可重用的差异化配置策略

​	（4）Member Cluster API：用户自助可查的资源池基本单元

##### 3、Karmada特性与生态

托管集群 私有集群 边缘集群

**例子**：GitOps——原生API与Kubernetes成熟生态融合

**合作点一**：云际编排引擎Dashboard发布

**合作点二**：云际资源调度算法

**合作点三**：云际集群调度计量计费<br/>

<br/>



#### 四、云际安全存储

##### 1、基于TEE的云际安全计算与存储

**传统云计算面临的挑战**：规模巨大、负载变化剧烈

**新一代云计算**：围绕云际协作的多云协同的云计算

**可信执行环境**：允许应用程序在加密的内存区域处理敏感数据

**两类TEE**：Intel SGX / AMD SEV

**TEE远程认证**（Intel SGX）：确信是正确的TEE环境 / 确信正确完成了初始化 / 建立加密的通信通道

**可信计算——>可信存储**：数据在内存中安全——>数据在存储设备上安全

##### 2、数据存储的安全与性能分析

**TEE数据存储的安全性**：机密性 / 完整性 / 最新性 / 匿名性

**TEE安全性假设**：TEE硬件是可信的 / TEE内部软件是可信的 / Remote attestation是可信的

##### 3、基于log结构的安全存储（WiP）

**Log-Structured Secure Disk**：消灭传统方案的写放大问题

##### 4、总结与展望

**conclusion**：可通用，覆盖各种TEE应用场景，应用于各种TEE软件栈

**future work**：Intermediate State

<br/><br/>

#### 五、云上分布式计算：Scaling up Distributed Learning on Cloud with System Relaxations——Bagua

##### 1、系统背景和目标

**背景**：用户对云服务的算力需求增加，如何提高训练效率？

**目标**：支持多种通信模式的分布式训练系统，提高深度学习应用在云上的可扩展性

**数据并行的分布式训练**：把数据分配到多个训练节点，每个节点拥有全部模型参数，节点之间如何同步？何种通信方式？——>通信模式：去中心化、误差补偿的低精度通信、异步通信等。

**Bagua系统三个挑战**：算法和理论 / 系统设计 / 系统评估

##### 2、算法和理论

**中心化同步算法**：每个节点并行计算模型梯度 / 所有节点在每次迭代时严格同步，通过参数服务器或Allreduce无损数据传输。

##### 3、系统架构和优化

**现有的系统主要基于两种通信架构**：参数服务器和MPI-style Allreduce，他们都无法满足上述多样的通信模式，Bagua需要设计新的系统架构，以模块化的，可复用的方式支持多种通信模式。

**层次**：物理通信层——逻辑通信层——算法层，未经优化的系统无法发挥算法的优势，通过通信层并行起来并细化参数来优化流水线。

**优化过程有很多细节，需要兼顾正确性和效率**：Scatter-Gather的通信模式 / 分层次的通信策略 / 自动batching、bucketing……

##### 4、系统测试和评估

在拥有较强计算力和高速网络的集群中，Bagua在图像、文本、语音等多种训练任务上，相比目前最新的系统可以达到30%-50%的加速。

**低带宽网络环境**：低精度算法更有优势

**高延迟网络环境**：去中心化算法更有优势<br/><br/>



#### 六、云际计算环境下单云节点弹性块存储服务优化

对象存储系统

**Object Placement for OSS**：Centralized method / Decentralized method

**CRUSH**：灵活

**CRUSH的实现是两阶段的过程**：Object——PG mapping

​									  				 PG mapping——>OSD mapping

**CRUSH缺点**：会出现大量数据迁移，从而出现毛刺和抖动

​		能不能在保持CRUSH优点的基础上使得在集群扩容时迁移是可控的？

​		能不能把集群进行一个划分，从而实现隔离？

**MAPX**：

**Old PGs to old Layers， New PGs to New Layers.**

**Old Objects to old PGs， New Objects to New PGs.**

在保留CRUSH的优势的基础上，引入一个额外的时间映射使得在数据迁移上是可控的。<br/><br/>



#### 七、云际环境下数据中台能力演进

##### 1、多云云际演进

**多云的选择**：选型策略 / 使用成本 / 长期问题 / 解耦的多云方案

多云方案1/5：基本原则和SLA（最小集、解耦、多厂商、合规）

多云方案2/5：基础服务

多云方案3/5：早期NSP

多云方案4/5：大数据AI

多云方案5/5：展望

##### 2、数据中台

###### （1）数据接入

1/3：打点日志问题

2/3：规范化打点

3/3：动态埋点

**集群管理**：存算分离，冷热分离，生产开发分离

**元数据**：Spark/Flink/Hive/CH/HBase共用

**隐私数据规范化**

###### （2)大数据AI编排调度

1/2：把大数据AI串起来

2/2：Akka actor

###### （3）AB实验平台

1/3：正交实验，AA/AB，指标报表

2/3：打通流程，多种实验，量化评估

3/3：AA实验多次调平，数据重放

###### （4）经营分析平台<br/><br/>



#### 八、KubeSphere面向云原生应用的云际容器管理平台

##### 1、KubeSphere

**面向云原生应用的云际容器管理平台**：

​	以应用为视角		

​	多租户支持

​	多云多集群

​	一站式解决方案

**功能**：微服务 / CI/CD / 应用管理 / 监控&日志&告警 / 安全

**架构**：以Kubernetes的方式管理Kuberbetes  / 可插拔架构 / 适应标准，对接外置系统

**多租户**

##### 2、KubeSphere多集群方案演进

**多集群**：高可用 / 低延迟 / 故障隔离 / 业务隔离

联邦集群（已废弃）

联邦集群 Federation v2：单点问题，社区活跃度低，过于抽象

**KubeSphere云际多集群架构**：Host-Member架构 / 同一入口，统一管理 / 云际

##### 3、KubeSphere云际多集群管理方案

<br/><br/><br/>

### （二）感想

本次论坛令我印象最深刻的就是**云际计算的目标：服务无边界、云间有协作、资源易共享、价值可转换**。

正如王怀民院士的致辞所言：“实现服务无边界，云际有协作，价值有交换，数据共享是云际计算的新的目标。在其中我们想要特别突出的是多方云服务商、云资源的有效的深度融合。在过去的服务领域，比如航空服务领域、能源服务领域等都有多方服务者实现有效联合达成更广泛的市场和更有效的用户服务的业态。在云计算领域，未来也将发展出各类云服务商有效协作的模式，我们就是要为这样的一种发展趋势提供技术。“

通过这次论坛，首先我对于如何有效推进云际计算基础设施的建设、云际计算的核心技术和平台的发展有了更加深刻的认识，而云际计算的发展也可能会为国家未来数字经济提供新的基础设施提供新的方案。多云平台、云端互联也是一种开放的、创新的发展模式。

除此之外，**云际间的协作**也是至关重要的，只有各个行业各个领域在云端相互协作，才有可能实现更加高效的成果，实现共赢。

在本次论坛中听到的很多项目，比如如意OS都已经在github进行开源，这也让我对**开源生态**产生了思考：云际计算是一个创新，而谈到创新就离不开开源，而开源这种创新的方式，就是在不断创造巨人的新高度，让所有人都有机会站在越来越高的巨人的肩膀上做更多的创新，形成不断的迭代。